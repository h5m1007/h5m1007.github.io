---
title: dva
date: 2019-06-21 16:39:37
tags:
---

# DVA
----

### 目录结构

```bash
├── /dist/                    # 编译打包后目录
├── /src/                     # 源码目录
│ ├── /assets/                # 静态资源目录
│ ├── /components/            # UI组件目录
│ │ ├── /Forbid/              # 业务相关组件
│ │ │ └── forbid.css          
│ │ │ └── index.js            
│ ├── /containers/            # 容器组件目录
│ │ └── Forbid.js             
│ ├── /models/                # Model 一个模块对应一个model
│ ├── /services/              # 各模块接口请求
│ ├── /utils/                 # 公用工具
└── index.ejs                 
└── index.js                  # 入口文件
└── router.js                 # 路由文件
```

## component
----
UI组件，由开发者提供，负责UI视觉层；所有数据由props提供，不适用任何 `Redux` 的 API

## container
----
容器组件，由 `react-redux` 自动生成，管理数据及业务逻辑，不负责UI实现；使用 `Redux` 的 API

```
const UiComponent = ({state, dispatch, location, history}) => ();

const mapStateToProps = (state, ownProps) => state;

const mapDispatchToProps = (dispatch, ownProps) => {
    return {
        onAction: () => {
            dispatch({
                type: '',
                {data}
            })
        }
    }
};

export connect(
    mapStateToProps,
    mapDispatchToProps
)(UiComponent);

// 经connect后的组件，可获取到state, dispatch, location, history
```

## model
----
dva最为重要的部分，可当做是对redux、react-redux、redux-saga的封装

### namespace
model的命名空间，全局state的一个属性，即state.namespace

### state
对应的是 `reducer` 的 `initialState`

**额外说明**
react 的 state 和 redux 的 state 不是一个性质的东西，react 中的 state 是组件内部本身的状态，而 redux 的 state 则是 redux 本身的数据，提供给 react 使用，redux 也可提供给其它框架使用。

### subscription
*dom ready后执行*
订阅某些数据源，根据情况 `dispatch` 某些 `action`

### effects
对应的是 `redux-saga`，简化了使用方式
处理异步操作，发起异步action，*不能直接修改state*
本身为对象，存放的只能是 `generator` 生成器函数，每个函数携带两个参数 `action` 和 `effects`，
而 `effects` 包含 `put`、`call`、`select` 三个字段，其中 `put` 触发 `action`，`call` 调用异步处理逻辑，`select` 从 `state` 中获取数据

### reducers
发起同步action
*唯一可以修改state的地方*
本身为对象，存放的每个函数都携带两个参数：`state` 和 `action`
