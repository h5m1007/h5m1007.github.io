<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> DvaJS 一些概念 · Leooon Blog</title><meta name="description" content="DvaJS 一些概念 - Leon"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="google-site-verification" content="kx_a2Pxm8eUeXBh4VntVZ3IlkZpWcQMPjLgfTYpTLNI"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://h5m1007.github.io/atom.xml" title="Leooon Blog"><meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="Leooon Blog" type="application/atom+xml">
</head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">DvaJS 一些概念</h1><div class="post-info">Jun 21, 2019</div><div class="post-content"><h2 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">├── /dist/                    <span class="comment"># 编译打包后目录</span></span><br><span class="line">├── /src/                     <span class="comment"># 源码目录</span></span><br><span class="line">│ ├── /assets/                <span class="comment"># 静态资源目录</span></span><br><span class="line">│ ├── /components/            <span class="comment"># UI组件目录</span></span><br><span class="line">│ │ ├── /Forbid/              <span class="comment"># 业务相关组件</span></span><br><span class="line">│ │ │ └── forbid.css</span><br><span class="line">│ │ │ └── index.js</span><br><span class="line">│ ├── /containers/            <span class="comment"># 容器组件目录</span></span><br><span class="line">│ │ └── Forbid.js</span><br><span class="line">│ ├── /models/                <span class="comment"># Model 一个模块对应一个model</span></span><br><span class="line">│ ├── /services/              <span class="comment"># 各模块接口请求</span></span><br><span class="line">│ ├── /utils/                 <span class="comment"># 公用工具</span></span><br><span class="line">└── index.ejs</span><br><span class="line">└── index.js                  <span class="comment"># 入口文件</span></span><br><span class="line">└── router.js                 <span class="comment"># 路由文件</span></span><br></pre></td></tr></table></figure>

<h2 id="component"><a href="#component" class="headerlink" title="component"></a>component</h2><hr>
<p>UI组件，由开发者提供，负责UI视觉层；所有数据由props提供，不适用任何 <code>Redux</code> 的 API</p>
<h2 id="container"><a href="#container" class="headerlink" title="container"></a>container</h2><hr>
<p>容器组件，由 <code>react-redux</code> 自动生成，管理数据及业务逻辑，不负责UI实现；使用 <code>Redux</code> 的 API</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> UiComponent = <span class="function">(<span class="params">&#123;state, dispatch, location, history&#125;</span>) =&gt;</span> ();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mapStateToProps = <span class="function">(<span class="params">state, ownProps</span>) =&gt;</span> state;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mapDispatchToProps = <span class="function">(<span class="params">dispatch, ownProps</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        onAction: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">            dispatch(&#123;</span><br><span class="line">                type: <span class="string">''</span>,</span><br><span class="line">                &#123;data&#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> connect(</span><br><span class="line">    mapStateToProps,</span><br><span class="line">    mapDispatchToProps</span><br><span class="line">)(UiComponent);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 经connect后的组件，可获取到state, dispatch, location, history</span></span><br></pre></td></tr></table></figure>

<h2 id="model"><a href="#model" class="headerlink" title="model"></a>model</h2><hr>
<p>dva最为重要的部分，可当做是对redux、react-redux、redux-saga的封装</p>
<h3 id="namespace"><a href="#namespace" class="headerlink" title="namespace"></a>namespace</h3><p>model的命名空间，全局state的一个属性，即state.namespace</p>
<h3 id="state"><a href="#state" class="headerlink" title="state"></a>state</h3><p>对应的是 <code>reducer</code> 的 <code>initialState</code></p>
<p><strong>额外说明</strong><br>react 的 state 和 redux 的 state 不是一个性质的东西，react 中的 state 是组件内部本身的状态，而 redux 的 state 则是 redux 本身的数据，提供给 react 使用，redux 也可提供给其它框架使用。</p>
<h3 id="subscription"><a href="#subscription" class="headerlink" title="subscription"></a>subscription</h3><p><em>dom ready后执行</em><br>订阅某些数据源，根据情况 <code>dispatch</code> 某些 <code>action</code></p>
<h3 id="effects"><a href="#effects" class="headerlink" title="effects"></a>effects</h3><p>对应的是 <code>redux-saga</code>，简化了使用方式<br>处理异步操作，发起异步action，<em>不能直接修改state</em><br>本身为对象，存放的只能是 <code>generator</code> 生成器函数，每个函数携带两个参数 <code>action</code> 和 <code>effects</code>，<br>而 <code>effects</code> 包含 <code>put</code>、<code>call</code>、<code>select</code> 三个字段，其中 <code>put</code> 触发 <code>action</code>，<code>call</code> 调用异步处理逻辑，<code>select</code> 从 <code>state</code> 中获取数据</p>
<h3 id="reducers"><a href="#reducers" class="headerlink" title="reducers"></a>reducers</h3><p>发起同步action<br><em>唯一可以修改state的地方</em><br>本身为对象，存放的每个函数都携带两个参数：<code>state</code> 和 <code>action</code></p>
</div></article></div></main><footer><div class="paginator"><a href="/2019/06/25/learn-from-react/" class="prev">上一篇</a><a href="/2019/06/21/docker/" class="next">下一篇</a></div><div class="copyright"><p>© 2015 - 2020 <a href="https://h5m1007.github.io">Leon</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>